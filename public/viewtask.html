<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
    
    <title>App</title>
  </head>
  <body onload="initialize()">
  
	<table style="border: 1px solid black;width: 100%;" class="container">
		<tr style="text-align: center;"><td style="border: 1px solid black;"></td><td style="border: 1px solid black;">Name</td><td style="border: 1px solid black;">Date</td><td style="border: 1px solid black;">Time</td></tr>
	</table>
	
	
	<div class="error"></div>
	
	<button onclick="onSubmit()">Submit</button>
  
  
  <script> 
  
  let userID = ''
  
  function initialize() {
    liff.init((data) => {
	    liff.getProfile()
	    .then( ({ userId }) => {
	    	userID = userId
	    	fetchData(userId)
    	})
	})
  }
  
  function fetchData(userId) {
	  document.getElementsByClassName('error')[0].innerHTML = ''
	  document.getElementsByClassName('error')[0].innerHTML =+ 'fetch'
  	  fetch('https://line-jarturon.herokuapp.com/getTask?userId='+userId)
  	  .then((response) => {
		
	    return response.json();
	  }).then((myJson) => {
		let newRow
		let table
	    for (let each of myJson) {
			table = document.getElementsByClassName('container')[0]
			newRow = `<tr>
			<td style="border: 1px solid black;"><input type='checkbox' id='${each.name}'></td>
			<td style="border: 1px solid black;">${each.name}</td><td style="border: 1px solid black;">${each.date}</td>
			<td style="border: 1px solid black;">${each.time}</td>
			</tr>`;
			table.innerHTML += newRow
		}
	  }).catch(error => {
		    console.log(error)
			document.getElementsByClassName('error')[0].innerHTML += JSON.stringify(error)
	  });
  }
  
  function onSubmit() {
	  const allSelectedItem = document.querySelectorAll("input[type=checkbox]:checked")
	  let allSelectedID = []
	  for (const each of allSelectedItem) {
		  allSelectedID.push(each.id)
	  }
	  document.getElementsByClassName('error')[0].innerHTML += JSON.stringify(allSelectedID[0])
	  fetch('https://line-jarturon.herokuapp.com/removeTask/'+ userID, {
	        method: "DELETE", 
	        headers: { "Content-Type": "application/json" }
	        body: JSON.stringify(allSelectedID)
  	  }).then(response => response.json())
  
  
  
  </script>
  
  
  
  </body>
  
  </html>